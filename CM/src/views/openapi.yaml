openapi: 3.0.3
info:
  title: OCSMS API
  description: |
    本文档基于 OpenAPI 3.0 规范，定义了软课程管理平台（在线课程管理、教学资料、练习、历史记录、用户管理等）的一组 RESTful 接口。
    平台支持教师、助教、学生三类角色，所有接口返回均使用统一响应格式 `ApiResponse<T>`：
      ```java
      public class ApiResponse<T> {
        private int code;       // 业务状态码，与 HTTP 状态码不同
        private String message; // 说明信息
        private T data;         // 返回的数据主体
      }
      ```
    意味着所有返回都为以下格式：
      ```json
      {
        "code": ..., (e.g. 400, 1001)
        "message": ..., (e.g. "success")
        "data": {
          "xxx": ...
          "xxx": ...,
          ...
        }
      }
      ```
    HTTP状态码，400表示参数错误，404表示资源不存在（如用户ID不存在）
    业务状态码，待更新
  version: 3.0.0
servers:
  - url: http://localhost:8080
    description: 开发环境

tags:
  - name: Auth
    description: 用户认证与授权
  - name: Users
    description: 用户管理
  - name: Courses
    description: 课程管理
  - name: Classes
    description: 班级管理
  - name: Materials
    description: 教学资料管理
  - name: Questions
    description: 练习题目
  - name: Assignments
    description: 在线练习
  - name: Submissions
    description: 练习提交与批改
  - name: Records
    description: 历史记录

paths:
  /auth/register:
    post:
      tags: [Auth]
      summary: 用户注册
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: 注册成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseUser'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'

  /auth/login:
    post:
      tags: [Auth]
      summary: 用户登录
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 登录成功，返回 JWT Token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseToken'
        '401':
          description: 认证失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'

  /users/{userId}:
    get:
      tags: [Users]
      summary: 获取用户信息
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: 用户信息
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseUser'
        '404':
          description: 未找到用户
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
    put:
      tags: [Users]
      summary: 更新个人信息
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseUser'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
  /users/{userId}/courses:
    get:
      tags: [Users]
      summary: 获取指定学生参与的所有课程
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: 学生的课程列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseCourseList'

  /users/{userId}/courses/{courseId}/class:
    get:
      tags: [Users]
      summary: 获取指定学生在某课程中的班级信息
      parameters:
        - $ref: '#/components/parameters/UserId'
        - $ref: '#/components/parameters/CourseId'
      responses:
        '200':
          description: 学生所在班级
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseClass'
        '404':
          description: 未加入此课程
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'

  /courses:
    get:
      tags: [Courses]
      summary: 列出指定教师的所有课程
      parameters:
        - in: query
          name: teacherId
          schema:
            type: string
          description: 指定教师ID
      responses:
        '200':
          description: 课程列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseCourseList'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '404':
          description: 未找到教师
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
    post:
      tags: [Courses]
      summary: 教师创建课程
      parameters:
        - in: query
          name: teacherId
          schema:
            type: string
          description: 指定教师ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CourseCreate'
      responses:
        '201':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseCourse'

  /courses/{courseId}:
    get:
      tags: [Courses]
      summary: 获取课程详情
      parameters:
        - $ref: '#/components/parameters/CourseId'
      responses:
        '200':
          description: 课程详情
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseCourse'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '404':
          description: 未找到课程
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
    put:
      tags: [Courses]
      summary: 更新课程信息
      parameters:
        - $ref: '#/components/parameters/CourseId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CourseUpdate'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseCourse'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '404':
          description: 未找到课程
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'

    delete:
      tags: [Courses]
      summary: 删除课程
      parameters:
        - $ref: '#/components/parameters/CourseId'
      responses:
        '204':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '404':
          description: 未找到课程
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'

  /courses/{courseId}/classes:
    get:
      tags: [ Classes ]
      summary: 获取某课程下的所有班级
      parameters:
        - $ref: '#/components/parameters/CourseId'
      responses:
        '200':
          description: 班级列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseClassList'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '404':
          description: 未找到课程
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
  /courses/{courseId}/resources:
    post:
      tags: [Courses]
      summary: 上传课程资料（创建新资源或更新已有资源新版本）
      parameters:
        - $ref: '#/components/parameters/CourseId'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/MaterialUpload'
      responses:
        '201':
          description: 上传成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseMaterialVersion'

    get:
      tags: [Courses]
      summary: 列出指定课程的所有资料（仅返回最新版本）
      parameters:
        - $ref: '#/components/parameters/CourseId'
      responses:
        '200':
          description: 资料列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseMaterialList'

  /classes:
    get:
      tags: [Classes]
      summary: 列出所有班级
      parameters:
        - in: query
          name: courseId
          schema:
            type: string
          description: 按课程筛选
      responses:
        '200':
          description: 班级列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseClassList'
    post:
      tags: [Classes]
      summary: 创建班级
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClassCreate'
      responses:
        '201':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseClass'

  /classes/{classId}/students:
    get:
      tags: [Classes]
      summary: 列出班级学生
      parameters:
        - $ref: '#/components/parameters/ClassId'
      responses:
        '200':
          description: 学生列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseUserList'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '404':
          description: 未找到班级
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
    post:
      tags: [Classes]
      summary: 批量导入学生
      parameters:
        - $ref: '#/components/parameters/ClassId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                studentIds:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: 导入结果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseImportResult'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '404':
          description: 未找到班级
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'

  /classes/{classId}/tas:
    get:
      tags: [ Classes ]
      summary: 列出班级助教
      parameters:
        - $ref: '#/components/parameters/ClassId'
      responses:
        '200':
          description: 助教列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseUserList'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '404':
          description: 未找到班级
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'

    post:
      tags: [ Classes ]
      summary: 批量添加助教到班级
      parameters:
        - $ref: '#/components/parameters/ClassId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                taIds:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: 添加结果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseImportResult'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '404':
          description: 未找到班级
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'

  /classes/{classId}/assignments:
    get:
      tags: [ Assignments ]
      summary: 列出某班级下的所有作业
      parameters:
        - $ref: '#/components/parameters/ClassId'
      responses:
        '200':
          description: 班级作业列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseAssignmentList'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '404':
          description: 未找到班级
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
    post:
      tags: [ Assignments ]
      summary: 老师给某个班级布置作业
      parameters:
        - $ref: '#/components/parameters/ClassId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignmentCreateDto'
      responses:
        '201':
          description: 布置成功，返回新作业
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseAssignment'
        '400':
          description: 参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
        '404':
          description: 未找到班级
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'

  /classes/{classId}/resources:
    get:
      tags: [Classes]
      summary: 列出指定班级可见的资料（仅返回最新版本）
      parameters:
        - $ref: '#/components/parameters/ClassId'
      responses:
        '200':
          description: 班级可见资料列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseMaterialList'


  /materials/{materialId}/versions:
    get:
      tags: [Materials]
      summary: 列出指定资料的所有历史版本
      parameters:
        - $ref: '#/components/parameters/MaterialId'
      responses:
        '200':
          description: 版本列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVersionList'

  /materials/{materialId}/versions/{version}:
    get:
      tags: [Materials]
      summary: 获取指定版本的资料详情
      parameters:
        - $ref: '#/components/parameters/MaterialId'
        - name: version
          in: path
          required: true
          schema:
            type: integer
          description: 版本号，从1开始
      responses:
        '200':
          description: 单个版本详情
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseMaterialVersion'
  /questions:
    get:
      tags: [Questions]
      summary: 列出题库中所有题目
      parameters:
        - in: query
          name: courseId
          schema:
            type: string
          description: 按课程筛选题目
      responses:
        '200':
          description: 题目列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseQuestionList'
    post:
      tags: [Questions]
      summary: 在题库中新建题目
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestionCreateDto'
      responses:
        '201':
          description: 创建成功，返回新题目
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseQuestion'

  /questions/{questionId}:
    get:
      tags: [Questions]
      summary: 获取题目详情
      parameters:
        - $ref: '#/components/parameters/QuestionId'
      responses:
        '200':
          description: 单个题目详情
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseQuestion'
    put:
      tags: [Questions]
      summary: 更新题目
      parameters:
        - $ref: '#/components/parameters/QuestionId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestionUpdateDto'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseQuestion'
    delete:
      tags: [Questions]
      summary: 删除题目
      parameters:
        - $ref: '#/components/parameters/QuestionId'
      responses:
        '204':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'

  /assignments/{assignmentId}:
    get:
      tags: [Assignments]
      summary: 获取作业详情
      parameters:
        - $ref: '#/components/parameters/AssignmentId'
      responses:
        '200':
          description: 单个作业详情
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseAssignment'
    put:
      tags: [Assignments]
      summary: 更新作业基本信息
      parameters:
        - $ref: '#/components/parameters/AssignmentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssignmentUpdateDto'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseAssignment'

  /assignments/{assignmentId}/questions:
    get:
      tags: [Assignments]
      summary: 列出一个作业包含的所有题目
      parameters:
        - $ref: '#/components/parameters/AssignmentId'
      responses:
        '200':
          description: 作业题目列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseQuestionList'
    post:
      tags: [Assignments]
      summary: 从题库导入题目到作业
      parameters:
        - $ref: '#/components/parameters/AssignmentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IdListDto'
      responses:
        '200':
          description: 导入结果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseImportResult'

  /classes/{classId}/assignments/{assignmentId}/submissions:
    get:
      tags: [Submissions]
      summary: 教师查看某班级下某作业的全部提交
      parameters:
        - $ref: '#/components/parameters/ClassId'
        - $ref: '#/components/parameters/AssignmentId'
      responses:
        '200':
          description: 提交记录列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseSubmissionList'
    post:
      tags: [Submissions]
      summary: 学生向指定班级的作业提交答案
      parameters:
        - $ref: '#/components/parameters/ClassId'
        - $ref: '#/components/parameters/AssignmentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmissionCreateDto'
      responses:
        '201':
          description: 提交成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseSubmission'

  /submissions/{submissionId}:
    get:
      tags: [Submissions]
      summary: 查看单次提交详情
      parameters:
        - $ref: '#/components/parameters/SubmissionId'
      responses:
        '200':
          description: 提交详情
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseSubmission'

  /submissions/{submissionId}/grade:
    put:
      tags: [ Submissions ]
      summary: 教师批改主观题（不影响自动批改题目）
      parameters:
        - $ref: '#/components/parameters/SubmissionId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManualGradeDto'
      responses:
        '200':
          description: 批改成功，返回更新后的提交详情
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseSubmission'

  /records/learning:
    get:
      tags: [Records]
      summary: 学习记录查询
      responses:
        '200':
          description: 学习轨迹
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseLearningRecordList'

  /records/exercise:
    get:
      tags: [Records]
      summary: 练习记录查询
      responses:
        '200':
          description: 练习记录
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseExerciseRecordList'

components:
  parameters:
    UserId:
      name: userId
      in: path
      required: true
      schema:
        type: string
      description: 用户唯一标识
    CourseId:
      name: courseId
      in: path
      required: true
      schema:
        type: string
      description: 课程唯一标识
    ClassId:
      name: classId
      in: path
      required: true
      schema:
        type: string
      description: 班级唯一标识
    QuestionId:
      name: questionId
      in: path
      required: true
      schema:
        type: string
      description: 题目唯一标识
    AssignmentId:
      name: assignmentId
      in: path
      required: true
      schema:
        type: string
      description: 作业唯一标识
    SubmissionId:
      name: submissionId
      in: path
      required: true
      schema:
        type: string
      description: 提交记录唯一标识
    MaterialId:
      name: materialId
      in: path
      required: true
      schema:
        type: string
      description: 资料组唯一标识
  schemas:
    ApiResponse:
      type: object
      description: 统一响应体
      properties:
        code:
          type: integer
          description: 业务状态码，与 HTTP 状态码不同
          example: 200
        message:
          type: string
          description: 说明信息
          example: "success"
        data:
          description: 返回的数据主体

    ApiResponseVoid:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: object
          nullable: true

    ApiResponseUser:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          $ref: '#/components/schemas/User'

    ApiResponseToken:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          $ref: '#/components/schemas/TokenResponse'

    ApiResponseUserList:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/User'

    ApiResponseCourse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          $ref: '#/components/schemas/Course'

    ApiResponseCourseList:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Course'

    ApiResponseClass:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          $ref: '#/components/schemas/Class'

    ApiResponseClassList:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Class'
    ApiResponseMaterialList:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Material'

    ApiResponseMaterialVersion:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          $ref: '#/components/schemas/MaterialVersion'

    ApiResponseVersionList:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/MaterialVersion'




    ApiResponseLearningRecordList:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/LearningRecord'

    ApiResponseImportResult:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: object
          properties:
            importedCount:
              type: integer
              description: 成功导入的学生数量




    ApiResponseExerciseRecordList:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ExerciseRecord'
    TokenResponse:
      type: object
      properties:
        token:
          type: string

    RegisterRequest:
      type: object
      required: [username, password, role]
      properties:
        userId:
          type: string
        username:
          type: string
        password:
          type: string
        role:
          type: string
          enum: [teacher, ta, student]
        email:
          type: string

    LoginRequest:
      type: object
      required: [username, password]
      properties:
        userId:
          type: string
        password:
          type: string

    User:
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        role:
          type: string
        email:
          type: string

    UserUpdate:
      type: object
      properties:
        email:
          type: string
        password:
          type: string

    Course:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        code:
          type: string
        outline:
          type: string
          description: 课程大纲
        objectives:
          type: string
          description: 课程目标
        assessment:
          type: string
          description: 考核方式
        teacherId:
          type: string
        chapters:
          type: array
          description: 课程章节列表
          items:
            $ref: '#/components/schemas/ChapterCreate'
        completed:
          type: boolean
          description: 课程是否结课

    ChapterCreate:
      type: object
      required: [title, order]
      properties:
        title:
          type: string
          description: 章节标题
        order:
          type: integer
          description: 本章节在课程中的编号，从1开始

    CourseCreate:
      type: object
      required: [name, code]
      properties:
        name:
          type: string
        code:
          type: string
        outline:
          type: string
          description: 课程大纲
        objectives:
          type: string
          description: 课程目标
        assessment:
          type: string
          description: 考核方式
        chapters:
          type: array
          description: 课程章节列表
          items:
            $ref: '#/components/schemas/ChapterCreate'
        completed:
          type: boolean
          description: 课程是否结课

    CourseUpdate:
      allOf:
        - $ref: '#/components/schemas/CourseCreate'
      description: 与 `CourseCreate` 相同，支持修改包括章节列表在内的所有字段

    Class:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        code:
          type: string
        courseId:
          type: string

    ClassCreate:
      type: object
      required: [name, code, courseId]
      properties:
        name:
          type: string
        code:
          type: string
        courseId:
          type: string


    ExerciseRecord:
      type: object
      properties:
        assignmentId:
          type: string
        score:
          type: number
        status:
          type: string
          enum:
            - submitted
            - not_submitted
            - late
          description: 提交状态

    LearningRecord:
      type: object
      properties:
        courseId:
          type: string
        chapter:
          type: string
        completedAt:
          type: string
          format: date-time
    QuestionCreateDto:
      type: object
      required: [title, type, correctAnswer]
      properties:
        title:
          type: string
        type:
          type: string
          enum: [choice, coding]
        choices:
          type: array
          items:
            type: string
          description: 仅对 choice 类型生效
        correctAnswer:
          type: string
          description: 客观题的标准答案
        score:
          type: integer
          description: 本题分值

    QuestionUpdateDto:
      allOf:
        - $ref: '#/components/schemas/QuestionCreateDto'

    Question:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        type:
          type: string
        choices:
          type: array
          items:
            type: string
        correctAnswer:
          type: string
        score:
          type: integer

    AssignmentCreateDto:
      type: object
      required: [title, courseId, openTime, dueDate]
      properties:
        title:
          type: string
        description:
          type: string
        courseId:
          type: string
        openTime:
          type: string
          format: date-time
        dueDate:
          type: string
          format: date-time
        allowResubmit:
          type: boolean
          description: 是否允许学生多次提交
        questionIds:
          type: array
          items:
            type: string

    MaterialUpload:
      type: object
      required: [file, chapterOrder]
      properties:
        file:
          type: string
          format: binary
        chapterOrder:
          type: integer
          description: 资源所属章节编号，从1开始
        description:
          type: string
        visibleForClasses:
          type: array
          items:
            type: string
          description: 如果不传这个字段（即null）表示所有班级均可见，若为空列表则均不可见

    Material:
      type: object
      properties:
        materialId:
          type: string
        chapterOrder:
          type: integer
        visibleForClasses:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        latestVersion:
          type: integer
          description: 最新版本号

    MaterialVersion:
      type: object
      properties:
        materialId:
          type: string
        version:
          type: integer
        filename:
          type: string
        url:
          type: string
        description:
          type: string
        uploadedAt:
          type: string
          format: date-time
    AssignmentUpdateDto:
      allOf:
        - $ref: '#/components/schemas/AssignmentCreateDto'

    Assignment:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        courseId:
          type: string
        openTime:
          type: string
          format: date-time
        dueDate:
          type: string
          format: date-time
        allowResubmit:
          type: boolean
        questionCount:
          type: integer

    SubmissionCreateDto:
      type: object
      required: [studentId, answers]
      properties:
        studentId:
          type: string
        answers:
          type: array
          items:
            $ref: '#/components/schemas/AnswerDto'

    AnswerDto:
      type: object
      properties:
        questionId:
          type: string
        response:
          type: string

    AnswerResultDto:
      type: object
      properties:
        questionId:
          type: string
        response:
          type: string
        score:
          type: integer
          nullable: true
        correct:
          type: boolean
          nullable: true
        feedback:
          type: string
          nullable: true

    SubmissionGradeDto:
      type: object
      required: [score]
      properties:
        score:
          type: integer
        feedback:
          type: string

    Submission:
      type: object
      properties:
        submissionId:
          type: string
        assignmentId:
          type: string
        studentId:
          type: string
        answers:
          type: array
          items:
            $ref: '#/components/schemas/AnswerResultDto'
        autoScore:
          type: integer
          description: 自动批改所得分
        manualScore:
          type: integer
          nullable: true
          description: 教师批改所得分
        totalScore:
          type: integer
          description: 总分 = autoScore + manualScore
        status:
          type: string
          enum: [ submitted, graded ]
        submittedAt:
          type: string
          format: date-time

    ManualGradeDto:
      type: object
      required: [ grades ]
      properties:
        grades:
          type: array
          items:
            type: object
            required: [ questionId, score ]
            properties:
              questionId:
                type: string
              score:
                type: integer
              feedback:
                type: string

    ApiResponseQuestion:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          $ref: '#/components/schemas/Question'

    ApiResponseQuestionList:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Question'

    ApiResponseAssignment:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          $ref: '#/components/schemas/Assignment'

    ApiResponseAssignmentList:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Assignment'

    ApiResponseSubmission:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          $ref: '#/components/schemas/Submission'

    ApiResponseSubmissionList:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Submission'

    IdListDto:
      type: object
      required: [ids]
      properties:
        ids:
          type: array
          items:
            type: string